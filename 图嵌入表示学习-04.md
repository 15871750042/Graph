## 随机游走的艺术-图嵌入表示学习（‼️）

### 0、为什么要对图进行嵌入？

直接在这种非结构的，数量不定（可能数目非常多），属性复杂的 图 上进行机器学习/深度学习是很困难的，而如果能处理为向量将非常的方便。即将节点映射成D维**低纬、稠密的向量**，这便是**图嵌入表示学习**。而**节点向量之间的距离能够衡量原图中邻接关系强弱**。

### 1.如何将节点映射成D维向量？（图嵌入）

- 人工特征工程：节点重要度、集群系数、Graphlet
- **图表示学习**：通过**随机游走**构造**自监督学习任务**。DeepWalk、Node2Vec
- **矩阵分解**
- 深度学习：图神经网络

![截屏2023-02-23 下午7.45.46](https://p.ipic.vip/meb50v.png)

### 2.人工特征工程和图表示学习的流程异同点？

**人工特征工程**

![截屏2023-02-23 下午7.46.38](https://p.ipic.vip/qxkaqe.png)

**图表示学习：自动学习特征**

![截屏2023-02-23 下午7.47.52](https://p.ipic.vip/24r3az.png)

### 3.图嵌入表示学习

![截屏2023-02-23 下午7.50.10](https://p.ipic.vip/otnr4a.png)

![截屏2023-02-23 下午7.54.19](https://p.ipic.vip/ycxuxj.png)

### 4.图嵌入-基本表示框架（编码器-解码器）

![截屏2023-02-23 下午8.02.42](/Users/jiamei5/Library/Application Support/typora-user-images/截屏2023-02-23 下午8.02.42.png)

![截屏2023-02-23 下午8.04.14](https://p.ipic.vip/789m96.png)

如何定义节点之间的相似度？直接相连、间接相连、相同功能角色等等

![截屏2023-02-23 下午8.12.51](https://p.ipic.vip/ji1vpd.png)

![截屏2023-02-23 下午8.17.05](https://p.ipic.vip/egr18z.png)

**查表是浅编码器，深度学习方法是深编码器**

![截屏2023-02-23 下午8.20.06](https://p.ipic.vip/ovnbyr.png)

嵌入矩阵中矩阵列数表示节点个数，矩阵行数表示节点特征维度

![截屏2023-02-23 下午8.22.52](https://p.ipic.vip/o791lz.png)

![截屏2023-02-23 下午8.24.21](https://p.ipic.vip/jhdgbr.png)

随机游走是表示两个节点相似度，如果两个节点在**同一个随机游走序列**中，则说明两个节点是**相似**的。

### 5.图嵌入-随机游走方法

https://zhuanlan.zhihu.com/p/56380812

**DeepWalk**的思想类似word2vec，使用**图中节点与节点的共现关系**来学习节点的向量表示。那么关键问题是如何来描述节点与节点的共现关系，DeepWalk给出的方法是使用**随机游走的方式在图中进行节点采样**。（如果两个节点在现有随机游走序列中共现次数较多，说明两个节点较为相似）**DeepWalk使用DFS随机游走在图中进行节点采样，使用word2vec在采样的序列学习图中节点的向量表示。**

**RandomWalk**是一种**可重复访问已访问节点的深度优先遍历算法**。给定当前访问起始节点，从其邻居中随机采样节点作为下一个访问节点，重复此过程，直到访问序列长度满足预设条件。（**随机游走序列**）

随机游走的优点：

- 并行性：可以同时开多个walker从不同节点出发进行游走；
- 适应性：可以轻松应对动态网络，一旦有网络结构更新，只要有足够多的walker进行重新采样，就可以对其嵌入表示进行更新。

随机游走的缺点：

- 对图中已有的节点算嵌入或特征，用已有的方法，无法立刻泛化到新加入的节点，算是某种程度的过拟合；
- 随机游走只探索节点相邻、局部信息，在节点相邻的节点更容易被采样到，只能采样到地理相近的节点，而对于结构相似但不相邻节点很难挖掘出来；
- 仅利用图本身的连接信息，但是没利用节点的属性信息；

![截屏2023-02-23 下午8.30.08](https://p.ipic.vip/whd9al.png)

![截屏2023-02-23 下午8.29.08](https://p.ipic.vip/p430cr.png)

图机器学习和nlp方法互通

![截屏2023-02-23 下午8.33.09](https://p.ipic.vip/68uelt.png)

![截屏2023-02-23 下午8.33.40](https://p.ipic.vip/9pioms.png)

随机游走表示能力、计算便捷较优。

![截屏2023-02-23 下午8.43.30](https://p.ipic.vip/t9x0mo.png)

当两个节点越相似，则两个节点随机游走得到的最大似然函数得到概率越大。

![截屏2023-02-23 下午8.46.14](https://p.ipic.vip/j8n2yf.png)

![截屏2023-02-23 下午8.46.43](https://p.ipic.vip/86trnz.png)

![截屏2023-02-23 下午8.47.44](https://p.ipic.vip/troc8i.png)

![截屏2023-02-23 下午8.48.41](https://p.ipic.vip/gmwfxm.png)

复杂度为O(n^2)，需要对该过程进行优化，即需要负采样。

![截屏2023-02-23 下午8.49.40](https://p.ipic.vip/gb8oj5.png)

只考虑每个节点和随机k个节点之间的相似度，大大减轻计算量，k如何选择呢？

![截屏2023-02-23 下午8.55.28](https://p.ipic.vip/dfmmqs.png)

例如：14亿人，考虑每个人与其他的5-20个人计算相似度。

### 6.优化过程-随机梯度下降

![截屏2023-02-23 下午8.57.28](https://p.ipic.vip/d1v8cr.png)

![截屏2023-02-23 下午8.57.55](https://p.ipic.vip/hde76m.png)

![截屏2023-02-23 下午8.58.11](https://p.ipic.vip/87i5n3.png)

![截屏2023-02-23 下午8.59.31](https://p.ipic.vip/cx20h1.png)

### 7.Node2Vec

https://zhuanlan.zhihu.com/p/56542707

随机游走是深度优先算法，所以只要与节点相近的节点更容易被采样，而与节点相类似的节点无法被采样（距离相对较远），因此同时考虑深度优先和广度优先，就可以将这部分节点挖掘出来。

**原理**：node2vec是一种综合考虑**DFS邻域和BFS邻域**的graph embedding方法。简单来说，可以看作是deepwalk的一种扩展，是结合了**DFS和BFS随机游走的deepwalk**。Node2vec 可以看作是对 DeepWalk 的一种更广义的抽象，主要是改进DeepWalk的随机游走策略。由于普通的随机游走无法很好地保留节点的局部信息，所以Node2vec多做了两个参数 P和 Q来加以控制（完全随机时P=Q=1），以获取邻域信息和更复杂的依存信息。

- In-out，参数 Q 控制**选择其他的新顶点的概率**，**偏广度优先，重视局部，即节点重要性。**(广度优先算法)
- Return，参数 P 控制**返回原来顶点的概率**，**偏深度优先，重视全局，即群体重要性。**（深度优先算法）

**目标**：给定每个顶点条件下，令其**近邻顶点（如何定义近邻顶点很重要）出现的概率最大**。

![截屏2023-02-23 下午9.00.50](https://p.ipic.vip/uis58s.png)

![截屏2023-02-23 下午9.04.22](https://p.ipic.vip/0w71aj.png)

### 8.矩阵分解

![截屏2023-02-23 下午9.08.00](https://p.ipic.vip/ybttcv.png)

![截屏2023-02-23 下午9.08.20](https://p.ipic.vip/9qz49k.png)

随机游走和node2vec都可以转化为矩阵分解

![截屏2023-02-23 下午9.17.34](https://p.ipic.vip/2wprnv.png)

![截屏2023-02-23 下午9.18.10](https://p.ipic.vip/gbdr61.png)

### 9.嵌入全图

![截屏2023-02-23 下午9.19.04](https://p.ipic.vip/58ggle.png)

![截屏2023-02-23 下午9.19.31](https://p.ipic.vip/avs5qu.png)

### 10.line

https://zhuanlan.zhihu.com/p/56478167

LINE也是一种**基于邻域相似假设**的方法，只不过与DeepWalk使用DFS构造邻域不同的是，LINE可以看作是一种使用**BFS构造邻域**的算法。此外，**LINE还可以应用在带权图中(DeepWalk仅能用于无权图)**。

**一阶相似度**衡量**邻居关系**，如果两个节点直接相连，则两个节点的一阶相似度高；(**一阶相似度只能用于无向图**)

**二阶相似度**衡量**邻居重叠关系**，如果两个节点重叠的邻居越多，说明两个节点越相似；

优化技巧：负采样、边采样